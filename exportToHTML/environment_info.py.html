<html>
<head>
<title>environment_info.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6a8759;}
.s4 { color: #629755; font-style: italic;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
environment_info.py</font>
</center></td></tr></table>
<pre><span class="s0"># Copyright 2022 The JAX Authors.</span>
<span class="s0">#</span>
<span class="s0"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="s0"># you may not use this file except in compliance with the License.</span>
<span class="s0"># You may obtain a copy of the License at</span>
<span class="s0">#</span>
<span class="s0">#     https://www.apache.org/licenses/LICENSE-2.0</span>
<span class="s0">#</span>
<span class="s0"># Unless required by applicable law or agreed to in writing, software</span>
<span class="s0"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="s0"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="s0"># See the License for the specific language governing permissions and</span>
<span class="s0"># limitations under the License.</span>

<span class="s2">import </span><span class="s1">subprocess</span>
<span class="s2">import </span><span class="s1">sys</span>
<span class="s2">import </span><span class="s1">textwrap</span>
<span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s1">Optional</span><span class="s2">, </span><span class="s1">Union</span>

<span class="s2">from </span><span class="s1">jax </span><span class="s2">import </span><span class="s1">version</span>
<span class="s2">from </span><span class="s1">jax._src </span><span class="s2">import </span><span class="s1">lib</span>
<span class="s2">from </span><span class="s1">jax._src </span><span class="s2">import </span><span class="s1">xla_bridge</span>
<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>

<span class="s2">def </span><span class="s1">try_nvidia_smi() -&gt; Optional[str]:</span>
  <span class="s2">try</span><span class="s1">:</span>
    <span class="s2">return </span><span class="s1">subprocess.check_output([</span><span class="s3">'nvidia-smi'</span><span class="s1">]).decode()</span>
  <span class="s2">except </span><span class="s1">Exception:</span>
    <span class="s2">return None</span>


<span class="s2">def </span><span class="s1">print_environment_info(return_string: bool = </span><span class="s2">False</span><span class="s1">) -&gt; Union[</span><span class="s2">None, </span><span class="s1">str]:</span>
  <span class="s4">&quot;&quot;&quot;Returns a string containing local environment &amp; JAX installation information. 
 
  This is useful information to include when asking a question or filing a bug. 
 
  Args: return_string (bool) : if True, return the string rather than printing 
  to stdout. 
  &quot;&quot;&quot;</span>
  <span class="s0"># TODO(jakevdp): should we include other info, e.g. jax.config.values?</span>
  <span class="s1">python_version = sys.version.replace(</span><span class="s3">'</span><span class="s2">\n</span><span class="s3">'</span><span class="s2">, </span><span class="s3">' '</span><span class="s1">)</span>
  <span class="s2">with </span><span class="s1">np.printoptions(threshold=</span><span class="s5">4</span><span class="s2">, </span><span class="s1">edgeitems=</span><span class="s5">2</span><span class="s1">):</span>
    <span class="s1">devices_short = str(np.array(xla_bridge.devices())).replace(</span><span class="s3">'</span><span class="s2">\n</span><span class="s3">'</span><span class="s2">, </span><span class="s3">''</span><span class="s1">)</span>
  <span class="s1">info = textwrap.dedent(</span>
      <span class="s3">f&quot;&quot;&quot;</span><span class="s2">\ 
  </span><span class="s3">jax:    </span><span class="s2">{</span><span class="s1">version.__version__</span><span class="s2">}</span>
  <span class="s3">jaxlib: </span><span class="s2">{</span><span class="s1">lib.version_str</span><span class="s2">}</span>
  <span class="s3">numpy:  </span><span class="s2">{</span><span class="s1">np.__version__</span><span class="s2">}</span>
  <span class="s3">python: </span><span class="s2">{</span><span class="s1">python_version</span><span class="s2">}</span>
  <span class="s3">jax.devices (</span><span class="s2">{</span><span class="s1">xla_bridge.device_count()</span><span class="s2">} </span><span class="s3">total, </span><span class="s2">{</span><span class="s1">xla_bridge.local_device_count()</span><span class="s2">} </span><span class="s3">local): </span><span class="s2">{</span><span class="s1">devices_short</span><span class="s2">}</span>
  <span class="s3">process_count: </span><span class="s2">{</span><span class="s1">xla_bridge.process_count()</span><span class="s2">}</span><span class="s3">&quot;&quot;&quot;</span>
  <span class="s1">)</span>
  <span class="s1">nvidia_smi = try_nvidia_smi()</span>
  <span class="s2">if </span><span class="s1">nvidia_smi:</span>
    <span class="s1">info += </span><span class="s3">'</span><span class="s2">\n\n</span><span class="s3">$ nvidia-smi</span><span class="s2">\n</span><span class="s3">' </span><span class="s1">+ nvidia_smi</span>
  <span class="s2">if </span><span class="s1">return_string:</span>
    <span class="s2">return </span><span class="s1">info</span>
  <span class="s2">else</span><span class="s1">:</span>
    <span class="s2">return </span><span class="s1">print(info)</span>
</pre>
</body>
</html>