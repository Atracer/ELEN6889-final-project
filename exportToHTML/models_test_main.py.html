<html>
<head>
<title>models_test_main.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #629755; font-style: italic;}
.s3 { color: #cc7832;}
.s4 { color: #6a8759;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
models_test_main.py</font>
</center></td></tr></table>
<pre><span class="s0"># Copyright 2022 The JAX Authors.</span>
<span class="s0">#</span>
<span class="s0"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="s0"># you may not use this file except in compliance with the License.</span>
<span class="s0"># You may obtain a copy of the License at</span>
<span class="s0">#</span>
<span class="s0">#     https://www.apache.org/licenses/LICENSE-2.0</span>
<span class="s0">#</span>
<span class="s0"># Unless required by applicable law or agreed to in writing, software</span>
<span class="s0"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="s0"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="s0"># See the License for the specific language governing permissions and</span>
<span class="s0"># limitations under the License.</span>
<span class="s2">r&quot;&quot;&quot;Tests for converting Flax models using jax2tf. 
 
Note: we do not use actual absl tests for this since we do not want this to run 
as part of our CI. Instead, we mainly use these tests to generate the markdown 
file. 
 
Run this as follows: 
 
``` 
# Test all converters on all suites and regenerate the table. 
python3 models_test_main.py 
 
# Test only CNN and Resnet50 with the TFjs converter and don't write Markdown. 
python3 models_test_main.py \ 
    --examples=flax/cnn,flax/resnet50 \ 
    --converters=jax2tf_noxla_tfjs \ 
    --write_markdown=False 
 
# Execute all CNN tests (including the tests for shape polymorphism): 
python3 models_test_main.py --example_prefix=flax/cnn 
 
# Execute only a specific CNN test for shape polymorphism (NOTE: quotes and 
# commas are stripped from the example names). 
python3 models_test_main.py --examples=&quot;flax/cnn_[(b ...)]&quot; 
``` 
&quot;&quot;&quot;</span>
<span class="s3">from </span><span class="s1">absl </span><span class="s3">import </span><span class="s1">app</span>
<span class="s3">from </span><span class="s1">absl </span><span class="s3">import </span><span class="s1">flags</span>

<span class="s3">import </span><span class="s1">functools</span>
<span class="s3">import </span><span class="s1">numpy </span><span class="s3">as </span><span class="s1">np</span>
<span class="s3">import </span><span class="s1">os</span>
<span class="s3">import </span><span class="s1">re</span>
<span class="s3">import </span><span class="s1">jax</span>

<span class="s3">from </span><span class="s1">jax._src </span><span class="s3">import </span><span class="s1">dtypes</span>
<span class="s3">import </span><span class="s1">jax.numpy </span><span class="s3">as </span><span class="s1">jnp</span>

<span class="s3">import </span><span class="s1">datetime</span>
<span class="s3">from </span><span class="s1">typing </span><span class="s3">import </span><span class="s1">Dict</span><span class="s3">, </span><span class="s1">List</span><span class="s3">, </span><span class="s1">Sequence</span><span class="s3">, </span><span class="s1">Tuple</span>

<span class="s3">import </span><span class="s1">tensorflow </span><span class="s3">as </span><span class="s1">tf</span>

<span class="s3">from </span><span class="s1">jax.experimental.jax2tf.shape_poly </span><span class="s3">import </span><span class="s1">InconclusiveDimensionOperation</span>
<span class="s3">from </span><span class="s1">jax.experimental.jax2tf.tests.model_harness </span><span class="s3">import </span><span class="s1">ALL_HARNESSES</span>
<span class="s3">from </span><span class="s1">jax.experimental.jax2tf.tests.converters </span><span class="s3">import </span><span class="s1">ALL_CONVERTERS</span>

<span class="s1">flags.DEFINE_list(</span><span class="s4">&quot;converters&quot;</span><span class="s3">, </span><span class="s1">[x.name </span><span class="s3">for </span><span class="s1">x </span><span class="s3">in </span><span class="s1">ALL_CONVERTERS]</span><span class="s3">,</span>
                  <span class="s4">&quot;Which converters to test.&quot;</span><span class="s1">)</span>

<span class="s1">flags.DEFINE_list(</span><span class="s4">&quot;examples&quot;</span><span class="s3">, </span><span class="s1">[]</span><span class="s3">,</span>
                  <span class="s1">(</span><span class="s4">&quot;List of examples to test, e.g.: 'flax/mnist,flax/seq2seq'. &quot;</span>
                   <span class="s4">&quot;If empty, will test all examples.&quot;</span><span class="s1">))</span>

<span class="s1">flags.DEFINE_string(</span><span class="s4">&quot;example_prefix&quot;</span><span class="s3">, </span><span class="s4">&quot;&quot;</span><span class="s3">,</span>
                    <span class="s1">(</span><span class="s4">&quot;Prefix for filtering tests. For instance 'flax/mnist' &quot;</span>
                     <span class="s4">&quot;will test all examples starting with 'flax/mnist' &quot;</span>
                     <span class="s4">&quot;(including all polymorphic tests).&quot;</span><span class="s1">))</span>

<span class="s1">flags.DEFINE_bool(</span>
    <span class="s4">&quot;write_markdown&quot;</span><span class="s3">, True,</span>
    <span class="s4">&quot;If true, write results as Markdown. Otherwise, only output to stdout.&quot;</span><span class="s1">)</span>

<span class="s1">flags.DEFINE_bool(</span>
    <span class="s4">&quot;fail_on_error&quot;</span><span class="s3">, False,</span>
    <span class="s1">(</span><span class="s4">&quot;If true, exit with an error when a conversion fails. Useful for &quot;</span>
     <span class="s4">&quot;debugging because it will show the entire stack trace.&quot;</span><span class="s1">))</span>

<span class="s1">FLAGS = flags.FLAGS</span>


<span class="s3">def </span><span class="s1">_write_markdown(results: Dict[str</span><span class="s3">, </span><span class="s1">List[Tuple[str</span><span class="s3">, </span><span class="s1">str</span><span class="s3">,</span><span class="s1">]]]) -&gt; </span><span class="s3">None</span><span class="s1">:</span>
  <span class="s2">&quot;&quot;&quot;Writes all results to Markdown file.&quot;&quot;&quot;</span>
  <span class="s1">table_lines = []</span>
  <span class="s1">converters = FLAGS.converters</span>

  <span class="s1">table_lines.append(</span><span class="s4">&quot;| Example | &quot; </span><span class="s1">+ </span><span class="s4">&quot; &quot;</span><span class="s1">.join([</span><span class="s4">f&quot;</span><span class="s3">{</span><span class="s1">c</span><span class="s3">} </span><span class="s4">|&quot; </span><span class="s3">for </span><span class="s1">c </span><span class="s3">in </span><span class="s1">converters]))</span>
  <span class="s1">table_lines.append(</span><span class="s4">&quot;|&quot; </span><span class="s1">+ (</span><span class="s4">&quot; --- |&quot; </span><span class="s1">* (len(converters) + </span><span class="s5">1</span><span class="s1">)))</span>

  <span class="s1">error_lines = []</span>

  <span class="s3">def </span><span class="s1">_header2anchor(header):</span>
    <span class="s1">header = header.lower().replace(</span><span class="s4">&quot; &quot;</span><span class="s3">, </span><span class="s4">&quot;-&quot;</span><span class="s1">)</span>
    <span class="s1">header = </span><span class="s4">&quot;#&quot; </span><span class="s1">+ re.sub(</span><span class="s4">r&quot;[^a-zA-Z0-9_-]+&quot;</span><span class="s3">, </span><span class="s4">&quot;&quot;</span><span class="s3">, </span><span class="s1">header)</span>
    <span class="s3">return </span><span class="s1">header</span>

  <span class="s3">for </span><span class="s1">example_name</span><span class="s3">, </span><span class="s1">converter_results </span><span class="s3">in </span><span class="s1">results.items():</span>
    <span class="s0"># Make sure the converters are in the right order.</span>
    <span class="s3">assert </span><span class="s1">[c[</span><span class="s5">0</span><span class="s1">] </span><span class="s3">for </span><span class="s1">c </span><span class="s3">in </span><span class="s1">converter_results] == converters</span>
    <span class="s1">line = </span><span class="s4">f&quot;| `</span><span class="s3">{</span><span class="s1">example_name</span><span class="s3">}</span><span class="s4">` |&quot;</span>
    <span class="s1">example_error_lines = []</span>
    <span class="s3">for </span><span class="s1">converter_name</span><span class="s3">, </span><span class="s1">error_msg </span><span class="s3">in </span><span class="s1">converter_results:</span>
      <span class="s3">if not </span><span class="s1">error_msg:</span>
        <span class="s1">line += </span><span class="s4">&quot; YES |&quot;</span>
      <span class="s3">else</span><span class="s1">:</span>
        <span class="s1">error_header = (</span><span class="s4">f&quot;Example: `</span><span class="s3">{</span><span class="s1">example_name</span><span class="s3">}</span><span class="s4">` | &quot;</span>
                        <span class="s4">f&quot;Converter: `</span><span class="s3">{</span><span class="s1">converter_name</span><span class="s3">}</span><span class="s4">`&quot;</span><span class="s1">)</span>
        <span class="s1">example_error_lines.append(</span><span class="s4">&quot;### &quot; </span><span class="s1">+ error_header)</span>
        <span class="s1">example_error_lines.append(</span><span class="s4">f&quot;```</span><span class="s3">\n{</span><span class="s1">error_msg</span><span class="s3">}\n</span><span class="s4">```&quot;</span><span class="s1">)</span>
        <span class="s1">example_error_lines.append(</span><span class="s4">&quot;[Back to top](#summary-table)</span><span class="s3">\n</span><span class="s4">&quot;</span><span class="s1">)</span>
        <span class="s1">line += </span><span class="s4">f&quot; [NO](</span><span class="s3">{</span><span class="s1">_header2anchor(error_header)</span><span class="s3">}</span><span class="s4">) |&quot;</span>
    <span class="s1">table_lines.append(line)</span>

    <span class="s3">if </span><span class="s1">example_error_lines:</span>
      <span class="s1">error_lines.append(</span><span class="s4">f&quot;## `</span><span class="s3">{</span><span class="s1">example_name</span><span class="s3">}</span><span class="s4">`&quot;</span><span class="s1">)</span>
      <span class="s1">error_lines.extend(example_error_lines)</span>

  <span class="s1">g3doc_path = </span><span class="s4">&quot;../g3doc&quot;</span>
  <span class="s1">output_path = os.path.join(g3doc_path</span><span class="s3">, </span><span class="s4">&quot;convert_models_results.md&quot;</span><span class="s1">)</span>
  <span class="s1">template_path = output_path + </span><span class="s4">&quot;.template&quot;</span>

  <span class="s3">if </span><span class="s1">(workdir := </span><span class="s4">&quot;BUILD_WORKING_DIRECTORY&quot;</span><span class="s1">) </span><span class="s3">in </span><span class="s1">os.environ:</span>
    <span class="s1">os.chdir(os.path.dirname(os.environ[workdir]))</span>

  <span class="s3">with </span><span class="s1">tf.io.gfile.GFile(template_path</span><span class="s3">, </span><span class="s4">&quot;r&quot;</span><span class="s1">) </span><span class="s3">as </span><span class="s1">f_in</span><span class="s3">, </span><span class="s1">\</span>
       <span class="s1">tf.io.gfile.GFile(output_path</span><span class="s3">, </span><span class="s4">&quot;w&quot;</span><span class="s1">) </span><span class="s3">as </span><span class="s1">f_out:</span>
    <span class="s1">template = </span><span class="s4">&quot;&quot;</span><span class="s1">.join(f_in.readlines())</span>
    <span class="s1">template = template.replace(</span><span class="s4">&quot;{{generation_date}}&quot;</span><span class="s3">, </span><span class="s1">str(datetime.date.today()))</span>
    <span class="s1">template = template.replace(</span><span class="s4">&quot;{{table}}&quot;</span><span class="s3">, </span><span class="s4">&quot;</span><span class="s3">\n</span><span class="s4">&quot;</span><span class="s1">.join(table_lines))</span>
    <span class="s1">template = template.replace(</span><span class="s4">&quot;{{errors}}&quot;</span><span class="s3">, </span><span class="s4">&quot;</span><span class="s3">\n</span><span class="s4">&quot;</span><span class="s1">.join(error_lines))</span>

    <span class="s1">f_out.write(template)</span>

  <span class="s1">print(</span><span class="s4">&quot;Written converter results to&quot;</span><span class="s3">, </span><span class="s1">output_path)</span>


<span class="s3">def </span><span class="s1">_crop_convert_error(msg: str) -&gt; str:</span>
  <span class="s1">msg = msg.replace(</span><span class="s4">&quot;</span><span class="s3">\\</span><span class="s4">n&quot;</span><span class="s3">, </span><span class="s4">&quot;</span><span class="s3">\n</span><span class="s4">&quot;</span><span class="s1">).replace(</span><span class="s4">&quot;</span><span class="s3">\\</span><span class="s4">t&quot;</span><span class="s3">, </span><span class="s4">&quot;</span><span class="s3">\t</span><span class="s4">&quot;</span><span class="s1">)</span>

  <span class="s1">tflite_msg = </span><span class="s4">&quot;Some ops are not supported by the native TFLite runtime&quot;</span>
  <span class="s3">if </span><span class="s1">tflite_msg </span><span class="s3">in </span><span class="s1">msg:</span>
    <span class="s0"># Filters out only the missing ops.</span>
    <span class="s1">missing_ops = msg.split(</span><span class="s4">&quot;</span><span class="s3">\n</span><span class="s4">Details:</span><span class="s3">\n</span><span class="s4">&quot;</span><span class="s1">)[</span><span class="s5">1</span><span class="s1">].split(</span><span class="s4">&quot;</span><span class="s3">\n\n</span><span class="s4">&quot;</span><span class="s1">)[</span><span class="s5">0</span><span class="s1">]</span>
    <span class="s3">return </span><span class="s1">tflite_msg + </span><span class="s4">&quot;</span><span class="s3">\n</span><span class="s4">&quot; </span><span class="s1">+ missing_ops</span>

  <span class="s1">tfjs_msg = </span><span class="s4">&quot;Some ops in the model are custom ops&quot;</span>
  <span class="s3">if </span><span class="s1">tfjs_msg </span><span class="s3">in </span><span class="s1">msg:</span>
    <span class="s3">return </span><span class="s1">msg[msg.index(tfjs_msg):]</span>

  <span class="s3">return </span><span class="s1">msg</span>


<span class="s3">def </span><span class="s1">_get_random_data(x: jax.Array) -&gt; np.ndarray:</span>
  <span class="s1">dtype = dtypes.canonicalize_dtype(x.dtype)</span>
  <span class="s3">if </span><span class="s1">np.issubdtype(dtype</span><span class="s3">, </span><span class="s1">np.integer):</span>
    <span class="s3">return </span><span class="s1">np.random.randint(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">100</span><span class="s3">, </span><span class="s1">size=x.shape</span><span class="s3">, </span><span class="s1">dtype=dtype)</span>
  <span class="s3">elif </span><span class="s1">np.issubdtype(dtype</span><span class="s3">, </span><span class="s1">np.floating):</span>
    <span class="s3">return </span><span class="s1">np.array(np.random.uniform(size=x.shape)</span><span class="s3">, </span><span class="s1">dtype=dtype)</span>
  <span class="s3">elif </span><span class="s1">dtype == bool:</span>
    <span class="s3">return </span><span class="s1">np.random.choice(a=[</span><span class="s3">False, True</span><span class="s1">]</span><span class="s3">, </span><span class="s1">size=x.shape)</span>
  <span class="s3">else</span><span class="s1">:</span>
    <span class="s3">raise </span><span class="s1">ValueError(</span><span class="s4">f&quot;Unsupported dtype for numerical comparison: </span><span class="s3">{</span><span class="s1">dtype</span><span class="s3">}</span><span class="s4">&quot;</span><span class="s1">)</span>


<span class="s3">def </span><span class="s1">test_converters():</span>
  <span class="s2">&quot;&quot;&quot;Tests all converters and write output.&quot;&quot;&quot;</span>
  <span class="s3">def </span><span class="s1">_exit_if_empty(x</span><span class="s3">, </span><span class="s1">name):</span>
    <span class="s3">if not </span><span class="s1">x:</span>
      <span class="s1">print(</span><span class="s4">f&quot;WARNING: No </span><span class="s3">{</span><span class="s1">name</span><span class="s3">} </span><span class="s4">found to test! Exiting&quot;</span><span class="s1">)</span>
      <span class="s1">exit()</span>

  <span class="s3">def </span><span class="s1">_maybe_reraise(e):</span>
    <span class="s3">if </span><span class="s1">FLAGS.fail_on_error:</span>
      <span class="s3">raise </span><span class="s1">e</span>

  <span class="s3">def </span><span class="s1">_format(e):</span>
    <span class="s0"># InvalidArgumentError output is shown differently.</span>
    <span class="s1">msg = str(e) </span><span class="s3">if </span><span class="s1">repr(e).strip() == </span><span class="s4">&quot;InvalidArgumentError()&quot; </span><span class="s3">else </span><span class="s1">repr(e)</span>
    <span class="s1">msg = msg.replace(</span><span class="s4">&quot;</span><span class="s3">\n\n</span><span class="s4">&quot;</span><span class="s3">, </span><span class="s4">&quot;</span><span class="s3">\n</span><span class="s4">&quot;</span><span class="s1">)  </span><span class="s0"># Output newlines correctly.</span>
    <span class="s3">return </span><span class="s1">msg</span>

  <span class="s1">converters = list(</span>
      <span class="s1">filter(</span><span class="s3">lambda </span><span class="s1">x: x.name </span><span class="s3">in </span><span class="s1">FLAGS.converters</span><span class="s3">, </span><span class="s1">ALL_CONVERTERS))</span>
  <span class="s1">_exit_if_empty(converters</span><span class="s3">, </span><span class="s4">&quot;converters&quot;</span><span class="s1">)</span>

  <span class="s1">harnesses_to_test = {</span>
      <span class="s1">name: fn </span><span class="s3">for </span><span class="s1">name</span><span class="s3">, </span><span class="s1">fn </span><span class="s3">in </span><span class="s1">ALL_HARNESSES.items()</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s3">not </span><span class="s1">FLAGS.examples </span><span class="s3">or </span><span class="s1">name </span><span class="s3">in </span><span class="s1">FLAGS.examples) </span><span class="s3">and</span>
         <span class="s1">(</span><span class="s3">not </span><span class="s1">FLAGS.example_prefix </span><span class="s3">or </span><span class="s1">name.startswith(FLAGS.example_prefix))</span>
  <span class="s1">}</span>
  <span class="s1">_exit_if_empty(harnesses_to_test</span><span class="s3">, </span><span class="s4">&quot;harness&quot;</span><span class="s1">)</span>

  <span class="s1">results = {}</span>
  <span class="s3">for </span><span class="s1">name</span><span class="s3">, </span><span class="s1">harness_fn </span><span class="s3">in </span><span class="s1">harnesses_to_test.items():</span>
    <span class="s1">harness = harness_fn()  </span><span class="s0"># This will create the variables.</span>
    <span class="s1">np_assert_allclose = functools.partial(</span>
        <span class="s1">np.testing.assert_allclose</span><span class="s3">, </span><span class="s1">rtol=harness.rtol)</span>
    <span class="s1">converter_results = []</span>
    <span class="s3">for </span><span class="s1">converter </span><span class="s3">in </span><span class="s1">converters:</span>
      <span class="s1">print(</span><span class="s4">f&quot;===== Testing example </span><span class="s3">{</span><span class="s1">harness.name</span><span class="s3">}</span><span class="s4">, &quot;</span>
            <span class="s4">f&quot;Converter </span><span class="s3">{</span><span class="s1">converter.name</span><span class="s3">}</span><span class="s4">&quot;</span><span class="s1">)</span>
      <span class="s1">error_msg = </span><span class="s4">&quot;&quot;</span>
      <span class="s3">try</span><span class="s1">:</span>
        <span class="s1">apply_tf = converter.convert_fn(harness)</span>
        <span class="s1">print(</span><span class="s4">&quot;=== Conversion OK!&quot;</span><span class="s1">)</span>
      <span class="s3">except </span><span class="s1">Exception </span><span class="s3">as </span><span class="s1">e:  </span><span class="s0"># pylint: disable=broad-except</span>
        <span class="s1">error_msg = </span><span class="s4">&quot;Conversion error</span><span class="s3">\n</span><span class="s4">&quot; </span><span class="s1">+ _crop_convert_error(repr(e))</span>
        <span class="s1">print(</span><span class="s4">f&quot;=== </span><span class="s3">{</span><span class="s1">error_msg</span><span class="s3">}</span><span class="s4">&quot;</span><span class="s1">)</span>
        <span class="s1">_maybe_reraise(e)</span>
      <span class="s3">else</span><span class="s1">:</span>
        <span class="s3">if not </span><span class="s1">converter.compare_numerics:</span>
          <span class="s1">print(</span><span class="s4">&quot;=== Skipping numerical comparison.&quot;</span><span class="s1">)</span>
        <span class="s3">else</span><span class="s1">:</span>
          <span class="s1">xs = [jax.tree_util.tree_map(_get_random_data</span><span class="s3">, </span><span class="s1">x) </span><span class="s3">for </span><span class="s1">x </span><span class="s3">in </span><span class="s1">harness.inputs]</span>
          <span class="s1">jax_result = harness.apply_with_vars(*xs)</span>
          <span class="s3">try</span><span class="s1">:</span>
            <span class="s1">tf_result = apply_tf(*xs)</span>
            <span class="s1">jax.tree_map(np_assert_allclose</span><span class="s3">, </span><span class="s1">jax_result</span><span class="s3">, </span><span class="s1">tf_result)</span>
            <span class="s1">print(</span><span class="s4">&quot;=== Numerical comparison OK!&quot;</span><span class="s1">)</span>
          <span class="s3">except </span><span class="s1">AssertionError </span><span class="s3">as </span><span class="s1">e:</span>
            <span class="s1">error_msg = </span><span class="s4">&quot;Numerical comparison error:</span><span class="s3">\n</span><span class="s4">&quot; </span><span class="s1">+ _format(e)</span>
            <span class="s1">print(</span><span class="s4">&quot;===&quot;</span><span class="s3">, </span><span class="s1">error_msg)</span>
            <span class="s1">_maybe_reraise(e)</span>
          <span class="s0"># Catch remaining but expected errors (we still want to fail on</span>
          <span class="s0"># unexpected errors).</span>
          <span class="s3">except </span><span class="s1">(</span>
              <span class="s0"># TFLite runtime error</span>
              <span class="s1">RuntimeError</span><span class="s3">,</span>
              <span class="s0"># TF error</span>
              <span class="s1">tf.errors.InvalidArgumentError</span><span class="s3">,</span>
              <span class="s0"># jax2tf poly shape errors.</span>
              <span class="s1">InconclusiveDimensionOperation</span><span class="s3">,</span>
              <span class="s1">TypeError</span><span class="s3">,</span>
              <span class="s1">IndexError</span><span class="s3">,</span>
              <span class="s1">ValueError) </span><span class="s3">as </span><span class="s1">e:</span>
            <span class="s1">error_msg = _format(e)</span>
            <span class="s1">print(</span><span class="s4">&quot;=== &quot;</span><span class="s3">, </span><span class="s1">error_msg)</span>
            <span class="s1">_maybe_reraise(e)</span>

      <span class="s1">converter_results.append((converter.name</span><span class="s3">, </span><span class="s1">error_msg))</span>
    <span class="s1">results[harness.name] = converter_results</span>

  <span class="s3">if </span><span class="s1">FLAGS.write_markdown:</span>
    <span class="s1">_write_markdown(results)</span>
  <span class="s3">else</span><span class="s1">:</span>
    <span class="s1">print(</span><span class="s4">&quot;=== NOT writing results to Markdown.&quot;</span><span class="s1">)</span>


<span class="s3">def </span><span class="s1">main(argv: Sequence[str]) -&gt; </span><span class="s3">None</span><span class="s1">:</span>
  <span class="s3">if </span><span class="s1">len(argv) &gt; </span><span class="s5">1</span><span class="s1">:</span>
    <span class="s3">raise </span><span class="s1">app.UsageError(</span><span class="s4">&quot;Too many command-line arguments.&quot;</span><span class="s1">)</span>

  <span class="s1">test_converters()</span>


<span class="s3">if </span><span class="s1">__name__ == </span><span class="s4">&quot;__main__&quot;</span><span class="s1">:</span>
  <span class="s1">app.run(main)</span>
</pre>
</body>
</html>