<html>
<head>
<title>pxla.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
pxla.py</font>
</center></td></tr></table>
<pre><span class="s0"># Copyright 2018 The JAX Authors.</span>
<span class="s0">#</span>
<span class="s0"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="s0"># you may not use this file except in compliance with the License.</span>
<span class="s0"># You may obtain a copy of the License at</span>
<span class="s0">#</span>
<span class="s0">#     https://www.apache.org/licenses/LICENSE-2.0</span>
<span class="s0">#</span>
<span class="s0"># Unless required by applicable law or agreed to in writing, software</span>
<span class="s0"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="s0"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="s0"># See the License for the specific language governing permissions and</span>
<span class="s0"># limitations under the License.</span>

<span class="s2">from </span><span class="s1">jax._src.interpreters.pxla </span><span class="s2">import </span><span class="s1">(</span>
  <span class="s1">AUTO </span><span class="s2">as </span><span class="s1">AUTO</span><span class="s2">,</span>
  <span class="s1">ArrayMapping </span><span class="s2">as </span><span class="s1">ArrayMapping</span><span class="s2">,</span>
  <span class="s1">ArrayMappingOrAutoOrUnspecified </span><span class="s2">as </span><span class="s1">ArrayMappingOrAutoOrUnspecified</span><span class="s2">,</span>
  <span class="s1">AvalDimSharding </span><span class="s2">as </span><span class="s1">AvalDimSharding</span><span class="s2">,</span>
  <span class="s1">Chunked </span><span class="s2">as </span><span class="s1">Chunked</span><span class="s2">,</span>
  <span class="s1">DynamicAxisEnv </span><span class="s2">as </span><span class="s1">DynamicAxisEnv</span><span class="s2">,</span>
  <span class="s1">DynamicAxisEnvFrame </span><span class="s2">as </span><span class="s1">DynamicAxisEnvFrame</span><span class="s2">,</span>
  <span class="s1">EmapInfo </span><span class="s2">as </span><span class="s1">EmapInfo</span><span class="s2">,</span>
  <span class="s1">ExecuteReplicated </span><span class="s2">as </span><span class="s1">ExecuteReplicated</span><span class="s2">,</span>
  <span class="s1">Index </span><span class="s2">as </span><span class="s1">Index</span><span class="s2">,</span>
  <span class="s1">InputsHandler </span><span class="s2">as </span><span class="s1">InputsHandler</span><span class="s2">,</span>
  <span class="s1">MapTrace </span><span class="s2">as </span><span class="s1">MapTrace</span><span class="s2">,</span>
  <span class="s1">MapTracer </span><span class="s2">as </span><span class="s1">MapTracer</span><span class="s2">,</span>
  <span class="s1">MeshComputation </span><span class="s2">as </span><span class="s1">MeshComputation</span><span class="s2">,</span>
  <span class="s1">MeshDimAssignment </span><span class="s2">as </span><span class="s1">MeshDimAssignment</span><span class="s2">,</span>
  <span class="s1">MeshExecutable </span><span class="s2">as </span><span class="s1">MeshExecutable</span><span class="s2">,</span>
  <span class="s1">NoSharding </span><span class="s2">as </span><span class="s1">NoSharding</span><span class="s2">,</span>
  <span class="s1">OpShardingType </span><span class="s2">as </span><span class="s1">OpShardingType</span><span class="s2">,</span>
  <span class="s1">OrderedDictType </span><span class="s2">as </span><span class="s1">OrderedDictType</span><span class="s2">,</span>
  <span class="s1">ParallelCallableInfo </span><span class="s2">as </span><span class="s1">ParallelCallableInfo</span><span class="s2">,</span>
  <span class="s1">PartitionInfo </span><span class="s2">as </span><span class="s1">PartitionInfo</span><span class="s2">,</span>
  <span class="s1">PartitionsOrReplicated </span><span class="s2">as </span><span class="s1">PartitionsOrReplicated</span><span class="s2">,</span>
  <span class="s1">PmapComputation </span><span class="s2">as </span><span class="s1">PmapComputation</span><span class="s2">,</span>
  <span class="s1">PmapExecutable </span><span class="s2">as </span><span class="s1">PmapExecutable</span><span class="s2">,</span>
  <span class="s1">PxlaResultHandler </span><span class="s2">as </span><span class="s1">PxlaResultHandler</span><span class="s2">,</span>
  <span class="s1">ReplicaInfo </span><span class="s2">as </span><span class="s1">ReplicaInfo</span><span class="s2">,</span>
  <span class="s1">Replicated </span><span class="s2">as </span><span class="s1">Replicated</span><span class="s2">,</span>
  <span class="s1">ResultsHandler </span><span class="s2">as </span><span class="s1">ResultsHandler</span><span class="s2">,</span>
  <span class="s1">SPMDBatchTrace </span><span class="s2">as </span><span class="s1">SPMDBatchTrace</span><span class="s2">,</span>
  <span class="s1">ShardInfo </span><span class="s2">as </span><span class="s1">ShardInfo</span><span class="s2">,</span>
  <span class="s1">ShardedAxis </span><span class="s2">as </span><span class="s1">ShardedAxis</span><span class="s2">,</span>
  <span class="s1">ShardingSpec </span><span class="s2">as </span><span class="s1">ShardingSpec</span><span class="s2">,</span>
  <span class="s1">TileManual </span><span class="s2">as </span><span class="s1">TileManual</span><span class="s2">,</span>
  <span class="s1">TileVectorize </span><span class="s2">as </span><span class="s1">TileVectorize</span><span class="s2">,</span>
  <span class="s1">TilingMethod </span><span class="s2">as </span><span class="s1">TilingMethod</span><span class="s2">,</span>
  <span class="s1">UnloadedMeshExecutable </span><span class="s2">as </span><span class="s1">UnloadedMeshExecutable</span><span class="s2">,</span>
  <span class="s1">UnloadedPmapExecutable </span><span class="s2">as </span><span class="s1">UnloadedPmapExecutable</span><span class="s2">,</span>
  <span class="s1">Unstacked </span><span class="s2">as </span><span class="s1">Unstacked</span><span class="s2">,</span>
  <span class="s1">WeakRefList </span><span class="s2">as </span><span class="s1">WeakRefList</span><span class="s2">,</span>
  <span class="s1">_UNSPECIFIED </span><span class="s2">as </span><span class="s1">_UNSPECIFIED</span><span class="s2">,</span>
  <span class="s1">_create_pmap_sharding_spec </span><span class="s2">as </span><span class="s1">_create_pmap_sharding_spec</span><span class="s2">,</span>
  <span class="s1">_get_and_check_device_assignment </span><span class="s2">as </span><span class="s1">_get_and_check_device_assignment</span><span class="s2">,</span>
  <span class="s1">_get_sharding_specs </span><span class="s2">as </span><span class="s1">_get_sharding_specs</span><span class="s2">,</span>
  <span class="s1">_is_unspecified </span><span class="s2">as </span><span class="s1">_is_unspecified</span><span class="s2">,</span>
  <span class="s1">_one_replica_buffer_indices </span><span class="s2">as </span><span class="s1">_one_replica_buffer_indices</span><span class="s2">,</span>
  <span class="s1">_pmap_sharding_spec </span><span class="s2">as </span><span class="s1">_pmap_sharding_spec</span><span class="s2">,</span>
  <span class="s1">are_op_shardings_equal </span><span class="s2">as </span><span class="s1">are_op_shardings_equal</span><span class="s2">,</span>
  <span class="s1">array_mapping_to_axis_resources </span><span class="s2">as </span><span class="s1">array_mapping_to_axis_resources</span><span class="s2">,</span>
  <span class="s1">array_types </span><span class="s2">as </span><span class="s1">array_types</span><span class="s2">,</span>
  <span class="s1">custom_resource_typing_rules </span><span class="s2">as </span><span class="s1">custom_resource_typing_rules</span><span class="s2">,</span>
  <span class="s1">device_put </span><span class="s2">as </span><span class="s1">_deprecated_device_put</span><span class="s2">,</span>
  <span class="s1">find_partitions </span><span class="s2">as </span><span class="s1">find_partitions</span><span class="s2">,</span>
  <span class="s1">find_replicas </span><span class="s2">as </span><span class="s1">find_replicas</span><span class="s2">,</span>
  <span class="s1">full_to_shard_p </span><span class="s2">as </span><span class="s1">full_to_shard_p</span><span class="s2">,</span>
  <span class="s1">get_global_aval </span><span class="s2">as </span><span class="s1">get_global_aval</span><span class="s2">,</span>
  <span class="s1">get_local_aval </span><span class="s2">as </span><span class="s1">get_local_aval</span><span class="s2">,</span>
  <span class="s1">get_num_partitions </span><span class="s2">as </span><span class="s1">get_num_partitions</span><span class="s2">,</span>
  <span class="s1">global_aval_to_result_handler </span><span class="s2">as </span><span class="s1">global_aval_to_result_handler</span><span class="s2">,</span>
  <span class="s1">global_avals_to_results_handler </span><span class="s2">as </span><span class="s1">global_avals_to_results_handler</span><span class="s2">,</span>
  <span class="s1">global_result_handlers </span><span class="s2">as </span><span class="s1">global_result_handlers</span><span class="s2">,</span>
  <span class="s1">is_op_sharding_replicated </span><span class="s2">as </span><span class="s1">is_op_sharding_replicated</span><span class="s2">,</span>
  <span class="s1">local_aval_to_result_handler </span><span class="s2">as </span><span class="s1">local_aval_to_result_handler</span><span class="s2">,</span>
  <span class="s1">local_avals_to_results_handler </span><span class="s2">as </span><span class="s1">local_avals_to_results_handler</span><span class="s2">,</span>
  <span class="s1">local_result_handlers </span><span class="s2">as </span><span class="s1">local_result_handlers</span><span class="s2">,</span>
  <span class="s1">lower_mesh_computation </span><span class="s2">as </span><span class="s1">lower_mesh_computation</span><span class="s2">,</span>
  <span class="s1">lower_parallel_callable </span><span class="s2">as </span><span class="s1">lower_parallel_callable</span><span class="s2">,</span>
  <span class="s1">lower_sharding_computation </span><span class="s2">as </span><span class="s1">lower_sharding_computation</span><span class="s2">,</span>
  <span class="s1">maybe_extend_axis_env </span><span class="s2">as </span><span class="s1">maybe_extend_axis_env</span><span class="s2">,</span>
  <span class="s1">mesh_sharding_specs </span><span class="s2">as </span><span class="s1">mesh_sharding_specs</span><span class="s2">,</span>
  <span class="s1">multi_host_supported_collectives </span><span class="s2">as </span><span class="s1">multi_host_supported_collectives</span><span class="s2">,</span>
  <span class="s1">new_mesh_sharding_specs </span><span class="s2">as </span><span class="s1">new_mesh_sharding_specs</span><span class="s2">,</span>
  <span class="s1">op_sharding_to_indices </span><span class="s2">as </span><span class="s1">op_sharding_to_indices</span><span class="s2">,</span>
  <span class="s1">parallel_callable </span><span class="s2">as </span><span class="s1">parallel_callable</span><span class="s2">,</span>
  <span class="s1">partitioned_sharding_spec </span><span class="s2">as </span><span class="s1">partitioned_sharding_spec</span><span class="s2">,</span>
  <span class="s1">reconcile_num_partitions </span><span class="s2">as </span><span class="s1">reconcile_num_partitions</span><span class="s2">,</span>
  <span class="s1">replicate </span><span class="s2">as </span><span class="s1">replicate</span><span class="s2">,</span>
  <span class="s1">resource_typecheck </span><span class="s2">as </span><span class="s1">resource_typecheck</span><span class="s2">,</span>
  <span class="s1">shard_arg_handlers </span><span class="s2">as </span><span class="s1">shard_arg_handlers</span><span class="s2">,</span>
  <span class="s1">shard_args </span><span class="s2">as </span><span class="s1">shard_args</span><span class="s2">,</span>
  <span class="s1">shard_arg </span><span class="s2">as </span><span class="s1">shard_arg</span><span class="s2">,</span>
  <span class="s1">shard_aval </span><span class="s2">as </span><span class="s1">shard_aval</span><span class="s2">,</span>
  <span class="s1">shard_aval_handlers </span><span class="s2">as </span><span class="s1">shard_aval_handlers</span><span class="s2">,</span>
  <span class="s1">shard_to_full_p </span><span class="s2">as </span><span class="s1">shard_to_full_p</span><span class="s2">,</span>
  <span class="s1">sharding_spec_sharding_proto </span><span class="s2">as </span><span class="s1">sharding_spec_sharding_proto</span><span class="s2">,</span>
  <span class="s1">spec_to_indices </span><span class="s2">as </span><span class="s1">spec_to_indices</span><span class="s2">,</span>
  <span class="s1">spmd_primitive_batchers </span><span class="s2">as </span><span class="s1">spmd_primitive_batchers</span><span class="s2">,</span>
  <span class="s1">stage_parallel_callable </span><span class="s2">as </span><span class="s1">stage_parallel_callable</span><span class="s2">,</span>
  <span class="s1">tile_aval_nd </span><span class="s2">as </span><span class="s1">tile_aval_nd</span><span class="s2">,</span>
  <span class="s1">untile_aval_nd </span><span class="s2">as </span><span class="s1">untile_aval_nd</span><span class="s2">,</span>
  <span class="s1">vtile_by_mesh </span><span class="s2">as </span><span class="s1">vtile_by_mesh</span><span class="s2">,</span>
  <span class="s1">vtile_manual </span><span class="s2">as </span><span class="s1">vtile_manual</span><span class="s2">,</span>
  <span class="s1">wrap_name </span><span class="s2">as </span><span class="s1">wrap_name</span><span class="s2">,</span>
  <span class="s1">xb </span><span class="s2">as </span><span class="s1">xb</span><span class="s2">,</span>
  <span class="s1">xla_pmap </span><span class="s2">as </span><span class="s1">xla_pmap</span><span class="s2">,</span>
  <span class="s1">xla_pmap_impl </span><span class="s2">as </span><span class="s1">xla_pmap_impl</span><span class="s2">,</span>
  <span class="s1">xla_pmap_impl_lazy </span><span class="s2">as </span><span class="s1">xla_pmap_impl_lazy</span><span class="s2">,</span>
  <span class="s1">xla_pmap_p </span><span class="s2">as </span><span class="s1">xla_pmap_p</span><span class="s2">,</span>
<span class="s1">)</span>
<span class="s2">from </span><span class="s1">jax._src.mesh </span><span class="s2">import </span><span class="s1">(</span>
  <span class="s1">MeshAxisName </span><span class="s2">as </span><span class="s1">MeshAxisName</span><span class="s2">,</span>
  <span class="s1">thread_resources </span><span class="s2">as </span><span class="s1">thread_resources</span><span class="s2">,</span>
<span class="s1">)</span>

<span class="s0"># Deprecations</span>

<span class="s2">from </span><span class="s1">jax._src.mesh </span><span class="s2">import </span><span class="s1">Mesh </span><span class="s2">as </span><span class="s1">_deprecated_Mesh</span>
<span class="s2">from </span><span class="s1">jax._src.interpreters.pxla </span><span class="s2">import </span><span class="s1">(</span>
  <span class="s1">PartitionSpec </span><span class="s2">as </span><span class="s1">_deprecated_PartitionSpec</span><span class="s2">,</span>
  <span class="s1">ShardedDeviceArray </span><span class="s2">as </span><span class="s1">_deprecated_ShardedDeviceArray</span><span class="s2">,</span>
  <span class="s1">make_sharded_device_array </span><span class="s2">as </span><span class="s1">_deprecated_make_sharded_device_array</span><span class="s2">,</span>
<span class="s1">)</span>

<span class="s1">_deprecations = {</span>
    <span class="s0"># Added Feb 8, 2023:</span>
    <span class="s3">&quot;Mesh&quot;</span><span class="s1">: (</span>
        <span class="s3">&quot;jax.interpreters.pxla.Mesh is deprecated. Use jax.sharding.Mesh.&quot;</span><span class="s2">,</span>
        <span class="s1">_deprecated_Mesh</span><span class="s2">,</span>
    <span class="s1">)</span><span class="s2">,</span>
    <span class="s0"># Added Feb 8, 2023:</span>
    <span class="s3">&quot;PartitionSpec&quot;</span><span class="s1">: (</span>
        <span class="s1">(</span>
            <span class="s3">&quot;jax.interpreters.pxla.PartitionSpec is deprecated. Use &quot;</span>
            <span class="s3">&quot;jax.sharding.PartitionSpec.&quot;</span>
        <span class="s1">)</span><span class="s2">,</span>
        <span class="s1">_deprecated_PartitionSpec</span><span class="s2">,</span>
    <span class="s1">)</span><span class="s2">,</span>
    <span class="s0"># Added March 15, 2023:</span>
    <span class="s3">&quot;ShardedDeviceArray&quot;</span><span class="s1">: (</span>
        <span class="s1">(</span>
            <span class="s3">&quot;jax.interpreters.pxla.ShardedDeviceArray is deprecated. Use &quot;</span>
            <span class="s3">&quot;jax.Array.&quot;</span>
        <span class="s1">)</span><span class="s2">,</span>
        <span class="s1">_deprecated_ShardedDeviceArray</span><span class="s2">,</span>
    <span class="s1">)</span><span class="s2">,</span>
    <span class="s0"># make_sharded_device_array is deprecated as of March 3, 2023. jax.Array</span>
    <span class="s0"># is the default since November 2022.</span>
    <span class="s3">&quot;make_sharded_device_array&quot;</span><span class="s1">: (</span>
        <span class="s1">(</span>
            <span class="s3">&quot;jax.interpreters.pxla.make_sharded_device_array is deprecated as&quot;</span>
            <span class="s3">&quot; of March 3, 2023. Use jax.make_array_from_single_device_arrays.&quot;</span>
        <span class="s1">)</span><span class="s2">,</span>
        <span class="s1">_deprecated_make_sharded_device_array</span><span class="s2">,</span>
    <span class="s1">)</span><span class="s2">,</span>
    <span class="s3">&quot;device_put&quot;</span><span class="s1">: (</span>
        <span class="s1">(</span>
            <span class="s3">&quot;jax.interpreters.pxla.device_put is deprecated. Please use&quot;</span>
            <span class="s3">&quot; jax.device_put.&quot;</span>
        <span class="s1">)</span><span class="s2">,</span>
        <span class="s1">_deprecated_device_put</span><span class="s2">,</span>
    <span class="s1">)</span><span class="s2">,</span>
<span class="s1">}</span>

<span class="s2">import </span><span class="s1">typing</span>
<span class="s2">if </span><span class="s1">typing.TYPE_CHECKING:</span>
  <span class="s2">from </span><span class="s1">jax._src.mesh </span><span class="s2">import </span><span class="s1">Mesh </span><span class="s2">as </span><span class="s1">Mesh</span>
  <span class="s2">from </span><span class="s1">jax._src.interpreters.pxla </span><span class="s2">import </span><span class="s1">(</span>
    <span class="s1">PartitionSpec </span><span class="s2">as </span><span class="s1">PartitionSpec</span><span class="s2">,</span>
    <span class="s1">ShardedDeviceArray </span><span class="s2">as </span><span class="s1">ShardedDeviceArray</span><span class="s2">,</span>
    <span class="s1">device_put </span><span class="s2">as </span><span class="s1">device_put</span><span class="s2">,</span>
    <span class="s1">make_sharded_device_array </span><span class="s2">as </span><span class="s1">make_sharded_device_array</span><span class="s2">,</span>
  <span class="s1">)</span>
<span class="s2">else</span><span class="s1">:</span>
  <span class="s2">from </span><span class="s1">jax._src.deprecations </span><span class="s2">import </span><span class="s1">deprecation_getattr </span><span class="s2">as </span><span class="s1">_deprecation_getattr</span>
  <span class="s1">__getattr__ = _deprecation_getattr(__name__</span><span class="s2">, </span><span class="s1">_deprecations)</span>
  <span class="s2">del </span><span class="s1">_deprecation_getattr</span>
<span class="s2">del </span><span class="s1">typing</span>
</pre>
</body>
</html>